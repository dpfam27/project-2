# Backend Module Diagram - Visual Overview

## ğŸ—ï¸ Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          main.ts (Port 3000)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚   Swagger   â”‚  â”‚   CORS   â”‚  â”‚  Enable JWT â”‚                 â”‚
â”‚  â”‚     /api    â”‚  â”‚ :3001    â”‚  â”‚   Bearer    â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        app.module.ts                              â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ ConfigModule â”‚ â”‚DatabaseModuleâ”‚ â”‚LoggerMiddleware            â”‚
â”‚  â”‚   (.env)     â”‚ â”‚  (TypeORM)   â”‚ â”‚ (All Routes) â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              Business Modules (Imported)                 â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  AuthModule â”‚OrderModule  â”‚CatalogModuleâ”‚CustomerModuleâ”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Auth Module Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Auth Module                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  POST /auth/register                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  1. RegisterDto validation                               â”‚  â”‚
â”‚  â”‚  2. Hash password (bcrypt)                               â”‚  â”‚
â”‚  â”‚  3. Create User (username, password_hash, role)          â”‚  â”‚
â”‚  â”‚  4. IF role = 'customer' â†’ Create Customer record        â”‚  â”‚
â”‚  â”‚  5. Generate JWT (expires 1h)                            â”‚  â”‚
â”‚  â”‚  6. Return { access_token, user }                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  POST /auth/login                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  1. Find user by username                                â”‚  â”‚
â”‚  â”‚  2. Verify password (bcrypt.compare)                     â”‚  â”‚
â”‚  â”‚  3. Generate JWT with payload: {sub, username, role}     â”‚  â”‚
â”‚  â”‚  4. Return { access_token, user }                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  JWT Strategy                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  validate(payload) {                                     â”‚  â”‚
â”‚  â”‚    return { userId: payload.sub,                         â”‚  â”‚
â”‚  â”‚             username: payload.username,                  â”‚  â”‚
â”‚  â”‚             role: payload.role }                         â”‚  â”‚
â”‚  â”‚  }                                                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  Guards:                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚  JwtAuthGuard    â”‚  â”‚   RolesGuard     â”‚                   â”‚
â”‚  â”‚  (Verify token)  â”‚  â”‚ (Check role)     â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ›ï¸ Product/Catalog Module Structure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Catalog Module                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  Entities:                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                       Product                              â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚  id, name, description, image_url, published       â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â”‚                      â”‚ OneToMany                           â”‚  â”‚
â”‚  â”‚                      â–¼                                      â”‚  â”‚
â”‚  â”‚                  Variant[]                                 â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚  id, product_id, sku, attributes (JSON),           â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  price (decimal), stock (int)                      â”‚   â”‚  â”‚
â”‚  â”‚  â”‚                                                     â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  Getters: size, color                              â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                      Coupon                                â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚  id, code, type (percentage/fixed), value,         â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  active, valid_from, valid_to                      â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â”‚  Endpoints:                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  PUBLIC:                                                   â”‚ â”‚
â”‚  â”‚    GET  /catalog/products      â†’ List all products        â”‚ â”‚
â”‚  â”‚    GET  /catalog/products/:id  â†’ Product details          â”‚ â”‚
â”‚  â”‚    POST /catalog/coupons/validate â†’ Validate coupon       â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  ADMIN ONLY:                                               â”‚ â”‚
â”‚  â”‚    POST   /catalog/products    â†’ Create product           â”‚ â”‚
â”‚  â”‚    PUT    /catalog/products/:id â†’ Update product          â”‚ â”‚
â”‚  â”‚    DELETE /catalog/products/:id â†’ Delete product          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ›’ Order Module Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Order Module                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                    Cart System                                â”‚â”‚
â”‚  â”‚                                                               â”‚â”‚
â”‚  â”‚    Cart                      CartItem                         â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   OneToMany  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚â”‚
â”‚  â”‚  â”‚ id         â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ id              â”‚            â”‚â”‚
â”‚  â”‚  â”‚ user_id    â”‚              â”‚ cart_id         â”‚            â”‚â”‚
â”‚  â”‚  â”‚ created_at â”‚              â”‚ variant_id â”€â”€â”€â”€â”€â”¼â”€â”€â”         â”‚â”‚
â”‚  â”‚  â”‚ updated_at â”‚              â”‚ quantity        â”‚  â”‚         â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚ price           â”‚  â”‚         â”‚â”‚
â”‚  â”‚                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚         â”‚â”‚
â”‚  â”‚                                                     â”‚         â”‚â”‚
â”‚  â”‚  Endpoints:                                         â”‚         â”‚â”‚
â”‚  â”‚    GET    /cart              â†’ Get current cart    â”‚         â”‚â”‚
â”‚  â”‚    POST   /cart/items        â†’ Add item            â”‚         â”‚â”‚
â”‚  â”‚    PATCH  /cart/items/:id    â†’ Update quantity     â”‚         â”‚â”‚
â”‚  â”‚    DELETE /cart/items/:id    â†’ Remove item         â”‚         â”‚â”‚
â”‚  â”‚    DELETE /cart              â†’ Clear cart          â”‚         â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                         â”‚                          â”‚
â”‚                                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                   Order System                                â”‚â”‚
â”‚  â”‚                                                               â”‚â”‚
â”‚  â”‚    Order                     OrderItem           Variant      â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   OneToMany  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     (Product)  â”‚â”‚
â”‚  â”‚  â”‚ id         â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ id          â”‚        â–²       â”‚â”‚
â”‚  â”‚  â”‚ customer_idâ”œâ”€â”€â”€â”€â”€â”€â”       â”‚ order_id    â”‚        â”‚       â”‚â”‚
â”‚  â”‚  â”‚ order_number      â”‚       â”‚ variant_id â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚â”‚
â”‚  â”‚  â”‚ order_date â”‚      â”‚       â”‚ quantity    â”‚                â”‚â”‚
â”‚  â”‚  â”‚ status     â”‚      â”‚       â”‚ price       â”‚                â”‚â”‚
â”‚  â”‚  â”‚ total_amount      â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚â”‚
â”‚  â”‚  â”‚ coupon_codeâ”‚      â”‚                                      â”‚â”‚
â”‚  â”‚  â”‚ coupon_id  â”‚      â”‚                                      â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚                                      â”‚â”‚
â”‚  â”‚         â”‚             â”‚                                      â”‚â”‚
â”‚  â”‚         â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºCustomer                    â”‚â”‚
â”‚  â”‚         â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚â”‚
â”‚  â”‚         â”‚                        â”‚ id          â”‚            â”‚â”‚
â”‚  â”‚         â”‚                        â”‚ name        â”‚            â”‚â”‚
â”‚  â”‚         â”‚                        â”‚ email       â”‚            â”‚â”‚
â”‚  â”‚         â”‚                        â”‚ phone       â”‚            â”‚â”‚
â”‚  â”‚         â”‚                        â”‚ address     â”‚            â”‚â”‚
â”‚  â”‚         â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚â”‚
â”‚  â”‚         â”‚                                                    â”‚â”‚
â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºPayment                                  â”‚â”‚
â”‚  â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚â”‚
â”‚  â”‚                    â”‚ id              â”‚                      â”‚â”‚
â”‚  â”‚                    â”‚ order_id        â”‚                      â”‚â”‚
â”‚  â”‚                    â”‚ payment_method  â”‚                      â”‚â”‚
â”‚  â”‚                    â”‚ payment_status  â”‚                      â”‚â”‚
â”‚  â”‚                    â”‚ transaction_id  â”‚                      â”‚â”‚
â”‚  â”‚                    â”‚ amount          â”‚                      â”‚â”‚
â”‚  â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚â”‚
â”‚  â”‚                                                               â”‚â”‚
â”‚  â”‚  Status Flow:                                                â”‚â”‚
â”‚  â”‚  Pending â†’ Processing â†’ Shipped â†’ Completed                 â”‚â”‚
â”‚  â”‚                     â†˜                                        â”‚â”‚
â”‚  â”‚                       Canceled / Refunded                    â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Checkout Flow Diagram

```
Customer                Frontend              Backend                  Database
   â”‚                       â”‚                     â”‚                         â”‚
   â”‚ 1. Review cart        â”‚                     â”‚                         â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                     â”‚                         â”‚
   â”‚                       â”‚                     â”‚                         â”‚
   â”‚ 2. Click Checkout     â”‚                     â”‚                         â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                     â”‚                         â”‚
   â”‚                       â”‚                     â”‚                         â”‚
   â”‚                       â”‚ 3. POST /orders/checkout                      â”‚
   â”‚                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                         â”‚
   â”‚                       â”‚   {customer,items,  â”‚                         â”‚
   â”‚                       â”‚    shipping_fee,    â”‚                         â”‚
   â”‚                       â”‚    coupon_code}     â”‚                         â”‚
   â”‚                       â”‚                     â”‚                         â”‚
   â”‚                       â”‚                     â”‚ 4. Start Transaction    â”‚
   â”‚                       â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
   â”‚                       â”‚                     â”‚                         â”‚
   â”‚                       â”‚                     â”‚ 5. Validate Stock       â”‚
   â”‚                       â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
   â”‚                       â”‚                     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                       â”‚                     â”‚                         â”‚
   â”‚                       â”‚                     â”‚ 6. Apply Coupon         â”‚
   â”‚                       â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
   â”‚                       â”‚                     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                       â”‚                     â”‚                         â”‚
   â”‚                       â”‚                     â”‚ 7. Calculate Total      â”‚
   â”‚                       â”‚                     â”‚                         â”‚
   â”‚                       â”‚                     â”‚ 8. Create Order         â”‚
   â”‚                       â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
   â”‚                       â”‚                     â”‚                         â”‚
   â”‚                       â”‚                     â”‚ 9. Create OrderItems    â”‚
   â”‚                       â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
   â”‚                       â”‚                     â”‚                         â”‚
   â”‚                       â”‚                     â”‚ 10. Decrease Stock      â”‚
   â”‚                       â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
   â”‚                       â”‚                     â”‚                         â”‚
   â”‚                       â”‚                     â”‚ 11. Clear Cart          â”‚
   â”‚                       â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
   â”‚                       â”‚                     â”‚                         â”‚
   â”‚                       â”‚                     â”‚ 12. Commit Transaction  â”‚
   â”‚                       â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
   â”‚                       â”‚                     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                       â”‚                     â”‚                         â”‚
   â”‚                       â”‚ 13. Return Order    â”‚                         â”‚
   â”‚                       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                         â”‚
   â”‚                       â”‚                     â”‚                         â”‚
   â”‚ 14. Show Success      â”‚                     â”‚                         â”‚
   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚                         â”‚
   â”‚                       â”‚                     â”‚                         â”‚
   â”‚ 15. Redirect to       â”‚                     â”‚                         â”‚
   â”‚     /orders           â”‚                     â”‚                         â”‚
   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚                         â”‚
   â”‚                       â”‚                     â”‚                         â”‚
```

---

## ğŸ”’ Auth Guard Flow

```
HTTP Request: POST /cart/items
Headers: Authorization: Bearer eyJhbGci0iJ9.eyJzdWIi0jV9.SflKx...
Body: { variant_id: 1, quantity: 2, price: 199990 }
   â”‚
   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    @Auth('customer')                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                         â”‚  â”‚
â”‚  â”‚  1. @Roles('customer')                                 â”‚  â”‚
â”‚  â”‚     â””â”€> Set metadata ROLES_KEY = ['customer']         â”‚  â”‚
â”‚  â”‚                                                         â”‚  â”‚
â”‚  â”‚  2. @UseGuards(JwtAuthGuard)                           â”‚  â”‚
â”‚  â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚     â”‚  a. Extract token from header                â”‚   â”‚  â”‚
â”‚  â”‚     â”‚  b. Verify signature with JWT_SECRET         â”‚   â”‚  â”‚
â”‚  â”‚     â”‚  c. Decode payload                           â”‚   â”‚  â”‚
â”‚  â”‚     â”‚  d. Call JwtStrategy.validate(payload)       â”‚   â”‚  â”‚
â”‚  â”‚     â”‚  e. Attach user to request:                  â”‚   â”‚  â”‚
â”‚  â”‚     â”‚     request.user = {                         â”‚   â”‚  â”‚
â”‚  â”‚     â”‚       userId: 5,                             â”‚   â”‚  â”‚
â”‚  â”‚     â”‚       username: 'customer1',                 â”‚   â”‚  â”‚
â”‚  â”‚     â”‚       role: 'customer'                       â”‚   â”‚  â”‚
â”‚  â”‚     â”‚     }                                        â”‚   â”‚  â”‚
â”‚  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â”‚                                                         â”‚  â”‚
â”‚  â”‚  3. @UseGuards(RolesGuard)                             â”‚  â”‚
â”‚  â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚     â”‚  a. Read metadata ROLES_KEY = ['customer']  â”‚   â”‚  â”‚
â”‚  â”‚     â”‚  b. Get request.user.role = 'customer'      â”‚   â”‚  â”‚
â”‚  â”‚     â”‚  c. Check: 'customer' in ['customer']?      â”‚   â”‚  â”‚
â”‚  â”‚     â”‚  d. Return true âœ…                           â”‚   â”‚  â”‚
â”‚  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â”‚                                                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚
   â–¼
Controller Method Executes
   â”‚
   â–¼
CartService.addItem()
   â”‚
   â–¼
Return Response
```

---

## ğŸ“Š Database Relationships

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Database ERD                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    users (Authentication)              customers (Business Info)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ id (PK)        â”‚                  â”‚ id (PK)             â”‚
   â”‚ username       â”‚                  â”‚ name                â”‚
   â”‚ password_hash  â”‚                  â”‚ email               â”‚
   â”‚ role           â”‚                  â”‚ phone               â”‚
   â”‚ created        â”‚                  â”‚ address             â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                                   â”‚
            â”‚ 1:1 (if role=customer)            â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                            â”‚
              â–¼                            â–¼
         carts                         orders
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ id (PK)        â”‚            â”‚ id (PK)          â”‚
   â”‚ user_id (FK)   â”‚            â”‚ customer_id (FK) â”‚
   â”‚ created_at     â”‚            â”‚ order_number     â”‚
   â”‚ updated_at     â”‚            â”‚ order_date       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚ status           â”‚
            â”‚                    â”‚ total_amount     â”‚
            â”‚ 1:N                â”‚ coupon_code      â”‚
            â”‚                    â”‚ coupon_id (FK)   â”‚
            â–¼                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      cart_items                          â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚ 1:N
   â”‚ id (PK)        â”‚                     â”‚
   â”‚ cart_id (FK)   â”‚                     â–¼
   â”‚ variant_id (FK)â”‚               order_items
   â”‚ quantity       â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ price          â”‚            â”‚ id (PK)          â”‚
   â”‚ created_at     â”‚            â”‚ order_id (FK)    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚ variant_id (FK)  â”‚
            â”‚                    â”‚ quantity         â”‚
            â”‚                    â”‚ price            â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                            â”‚
                                 N:1        â”‚
                                            â–¼
                                        variants
                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                â”‚ id (PK)              â”‚
                                â”‚ product_id (FK)      â”‚
                                â”‚ sku                  â”‚
                                â”‚ attributes (JSON)    â”‚
                                â”‚ price                â”‚
                                â”‚ stock                â”‚
                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚
                                    N:1    â”‚
                                           â–¼
                                       products
                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                â”‚ id (PK)              â”‚
                                â”‚ name                 â”‚
                                â”‚ description          â”‚
                                â”‚ image_url            â”‚
                                â”‚ published            â”‚
                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

         coupons (Standalone)               payments
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ id (PK)          â”‚            â”‚ id (PK)          â”‚
      â”‚ code (unique)    â”‚            â”‚ order_id (FK)    â”‚
      â”‚ type             â”‚            â”‚ payment_method   â”‚
      â”‚ value            â”‚            â”‚ payment_status   â”‚
      â”‚ active           â”‚            â”‚ transaction_id   â”‚
      â”‚ valid_from       â”‚            â”‚ amount           â”‚
      â”‚ valid_to         â”‚            â”‚ created_at       â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Request Lifecycle

```
1. Client Request
   â”‚
   â–¼
2. CORS Middleware
   â”‚ Check origin = http://localhost:3001
   â”‚ Check headers = Content-Type, Authorization
   â–¼
3. Logger Middleware
   â”‚ Log [METHOD] URL
   â”‚ Log body, params, query
   â–¼
4. Controller
   â”‚ Route matching
   â”‚ Parameter extraction
   â–¼
5. Guards (if @Auth() present)
   â”‚
   â”œâ”€â–º JwtAuthGuard
   â”‚   â”‚ Validate JWT token
   â”‚   â”‚ Attach user to request
   â”‚   â–¼
   â””â”€â–º RolesGuard
       â”‚ Check user.role matches required roles
       â–¼
6. Controller Method
   â”‚ Dependency Injection
   â”‚ Call service methods
   â–¼
7. Service
   â”‚ Business logic
   â”‚ Database operations via Repository
   â–¼
8. Repository (TypeORM)
   â”‚ Generate SQL
   â”‚ Execute query
   â”‚ Return entities
   â–¼
9. Response
   â”‚ Transform data
   â”‚ Send JSON response
   â–¼
10. Client receives response
```

---

## ğŸ› ï¸ Module Dependencies

```
                      AppModule
                          â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                 â”‚                 â”‚
        â–¼                 â–¼                 â–¼
   AuthModule      OrderModule       CatalogModule
        â”‚                 â”‚                 â”‚
        â”‚                 â”‚                 â”‚
        â”œâ”€â”€â”€Exports:      â”œâ”€â”€â”€Exports:      â”œâ”€â”€â”€Exports:
        â”‚   JwtModule     â”‚   OrderService  â”‚   CatalogService
        â”‚   PassportModuleâ”‚   CartService   â”‚
        â”‚   AuthService   â”‚                 â”‚
        â”‚                 â”‚                 â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                      â”‚
                                                      â–¼
                                            CustomerModule
                                                      â”‚
                                                      â”œâ”€â”€â”€Exports:
                                                      â”‚   CustomerService

Common Utilities (Shared Across All Modules):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Guards:       JwtAuthGuard, RolesGuard                    â”‚
â”‚  Decorators:   @Auth(), @Roles()                           â”‚
â”‚  Middleware:   LoggerMiddleware                            â”‚
â”‚  DTOs:         Shared validation classes                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ˆ Scalability Considerations

### Current Architecture Strengths:
```
âœ… Modular Design          â†’ Easy to add new features
âœ… Dependency Injection    â†’ Testable & maintainable
âœ… TypeORM                 â†’ Database abstraction
âœ… Guard Composition       â†’ Reusable auth logic
âœ… DTO Validation          â†’ Type-safe API
```

### Future Improvements:
```
ğŸ“ˆ Caching Layer           â†’ Redis for sessions & products
ğŸ“ˆ Message Queue           â†’ RabbitMQ/Bull for async tasks
ğŸ“ˆ Microservices           â†’ Split modules into services
ğŸ“ˆ API Gateway             â†’ Centralized routing
ğŸ“ˆ Event-Driven            â†’ Event emitters for order updates
ğŸ“ˆ CQRS Pattern            â†’ Separate read/write models
ğŸ“ˆ GraphQL                 â†’ Flexible client queries
```

---

**Document Version:** 1.0  
**Last Updated:** November 5, 2025
